<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat App</title>
<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  function askUsername() {
    const username = prompt("Please enter your username for the chat:");
    if (username) {
      localStorage.setItem('username', username);
      socket.emit('new user', username); // Уведомляем сервер о новом пользователе
      enableInput();
    } else {
      askUsername();
    }
  }

  function enableInput() {
    document.getElementById('message-input').disabled = false;
    document.getElementById('send-button').disabled = false;
  }

  if (!localStorage.getItem('username')) {
    askUsername();
  } else {
    enableInput();
  }

  const messageInput = document.getElementById('message-input');
  const sendButton = document.getElementById('send-button');
  const messagesList = document.getElementById('messages');

  sendButton.addEventListener('click', () => {
    const message = messageInput.value.trim();
    const username = localStorage.getItem('username');
    if (message) {
      socket.emit('chat message', { username, message });
      messageInput.value = '';
    }
  });

  socket.on('chat message', ({ username, message, time }) => {
    const item = document.createElement('li');
    item.innerHTML = `<strong>${username}</strong>: ${message} <span class="time">${time}</span>`;
    messagesList.appendChild(item);
  });

  // Обработчик для статуса пользователя
  socket.on('user status', ({ username, status }) => {
    console.log(`${username} is now ${status}`);
    // Здесь можно добавить логику для отображения статуса пользователя
  });
</script>
<style>
  .time {
    font-size: 0.8em;
    color: #777;
  }
</style>
</head>
<body>
<div id="chat-container">
  <ul id="messages"></ul>
</div>
<input type="text" id="message-input" placeholder="Type your message here..." disabled>
<button id="send-button" disabled>Send</button>
</body>
</html>